serviceMaps:
  serviceName: advocate-clerk-services
  mappings:
    - version: 1.0
      description: Persists advocate clerk details in tables
      fromTopic: save-advocate-clerk
      isTransaction: true
      queryMaps:
        - query: INSERT INTO dristi_advocate_clerk(id, tenant_id, application_number,wf_status, individual_id, state_regn_number,is_active , created_by, last_modified_by, created_time, last_modified_time,additional_details) VALUES (?,?, ?, ?, ?, ?, ?, ?, ?, ?,?,?);
          basePath: clerk
          jsonMaps:
            - jsonPath: $.clerk.id
            - jsonPath: $.clerk.tenantId
            - jsonPath: $.clerk.applicationNumber
            - jsonPath: $.clerk.status
            - jsonPath: $.clerk.individualId
            - jsonPath: $.clerk.stateRegnNumber
            - jsonPath: $.clerk.isActive
            - jsonPath: $.clerk.auditDetails.createdBy
            - jsonPath: $.clerk.auditDetails.lastModifiedBy
            - jsonPath: $.clerk.auditDetails.createdTime
            - jsonPath: $.clerk.auditDetails.lastModifiedTime
            - jsonPath: $.clerk.additionalDetails
              type: JSON
              dbType: JSONB

        - query: INSERT INTO dristi_advocate_clerk_document(id,filestore_id,document_uid,document_type ,clerk_id,additional_details, is_active, created_by, last_modified_by, created_time, last_modified_time) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
          basePath: $.clerk.documents.*
          jsonMaps:
            - jsonPath: $.clerk.documents.*.id
            - jsonPath: $.clerk.documents.*.fileStore
            - jsonPath: $.clerk.documents.*.documentUid
            - jsonPath: $.clerk.documents.*.documentType
            - jsonPath: $.clerk[?({id} in @.documents[*].id)].id
            - jsonPath: $.clerk.documents.*.additionalDetails
              type: JSON
              dbType: JSONB
            - jsonPath: $.clerk.isActive
            - jsonPath: $.clerk.auditDetails.createdBy
            - jsonPath: $.clerk.auditDetails.lastModifiedBy
            - jsonPath: $.clerk.auditDetails.createdTime
            - jsonPath: $.clerk.auditDetails.lastModifiedTime

    - version: 1.0
      description: Update advocate clerk details in tables
      fromTopic: update-advocate-clerk-application
      isTransaction: true
      queryMaps:
        - query: UPDATE  dristi_advocate_clerk SET wf_status =?, is_active =?,last_modified_by =?,last_modified_time = ? where id =?;
          basePath: clerk
          jsonMaps:
            - jsonPath: $.clerk.status
            - jsonPath: $.clerk.isActive
            - jsonPath: $.clerk.auditDetails.lastModifiedBy
            - jsonPath: $.clerk.auditDetails.lastModifiedTime
            - jsonPath: $.clerk.id
